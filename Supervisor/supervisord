#!/bin/bash
#
# atd Starts/stop the "supervisord" daemon

PYTHON=`which python`
CONFIG="/etc/supervisor/supervisord.conf"
SUPERVISORD=`which supervisord`
SUPERVISOR_USER="root"
SUPERVISORD_CMD="${SUPERVISORD} -c ${CONFIG} --user=${SUPERVISOR_USER}"
pidfile="/var/run/supervisord.pid"


function super_start() {
	${PYTHON} ${SUPERVISORD_CMD}
	retval=$?
	echo "Starting ${SUPERVISORD}"
	return ${retval}
}

function super_stop() {
	kill -s 15 `cat "${pidfile}"`
	if [ $? == 0 ]
	then
		echo "Stoping ${SUPERVISORD}"
	else
		echo "Stoping ${SUPERVISORD} Failed"
	fi
	return $?
}

function super_restart() {
	super_stop
	super_start
	return $?
}

function super_status() {
	if [ -e ${pidfile} ]
	then
		echo "${SUPERVISORD} is running"
	else
		echo "${SUPERVISORD} is stopped"
	fi
}

case "$1" in
    start)
        super_start && exit 0
        $1
        ;;
    stop)
        super_stop && exit 0
        $1
        ;;
    restart)
	super_restart && exit 0
        $1
        ;;
    status)
        super_status
        ;;
    *)
        echo $"Usage: $0 {start|stop|status|restart}"
        exit 2
esac
exit $?
